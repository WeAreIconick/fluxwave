"use strict";(globalThis.webpackChunkfluxwave=globalThis.webpackChunkfluxwave||[]).push([[629],{629:(e,t,i)=>{i.r(t),i.d(t,{default:()=>O});var r=i(87),n=i(723),s=i(427),o=i(715),a=i(375),l=i(627),c=i(790),d=i(609);const u=typeof window<"u"?d.useLayoutEffect:d.useEffect;function h(e){if(void 0!==e)switch(typeof e){case"number":return e;case"string":if(e.endsWith("px"))return parseFloat(e)}}function m(e){const t=(0,d.useRef)(()=>{throw new Error("Cannot call during render.")});return u(()=>{t.current=e},[e]),(0,d.useCallback)(e=>t.current?.(e),[t])}let f=null;function x({containerElement:e,direction:t,isRtl:i,scrollOffset:r}){if("horizontal"===t&&i)switch(function(e=!1){if(null===f||e){const e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";const i=document.createElement("div"),r=i.style;return r.width="100px",r.height="100px",e.appendChild(i),document.body.appendChild(e),e.scrollLeft>0?f="positive-descending":(e.scrollLeft=1,f=0===e.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(e),f}return f}()){case"negative":return-r;case"positive-descending":if(e){const{clientWidth:t,scrollLeft:i,scrollWidth:r}=e;return r-t-i}}return r}function v(e,t="Assertion error"){if(!e)throw console.error(t),Error(t)}function g(e,t){if(e===t)return!0;if(!!e!=!!t||(v(void 0!==e),v(void 0!==t),Object.keys(e).length!==Object.keys(t).length))return!1;for(const i in e)if(!Object.is(t[i],e[i]))return!1;return!0}function p({cachedBounds:e,itemCount:t,itemSize:i}){if(0===t)return 0;if("number"==typeof i)return t*i;{const i=e.get(0===e.size?0:e.size-1);v(void 0!==i,"Unexpected bounds cache miss");return t*((i.scrollOffset+i.size)/e.size)}}function w({cachedBounds:e,containerScrollOffset:t,containerSize:i,itemCount:r,overscanCount:n}){const s=r-1;let o=0,a=-1,l=0,c=-1,d=0;for(;d<s;){const i=e.get(d);if(i.scrollOffset+i.size>t)break;d++}for(o=d,l=Math.max(0,o-n);d<s;){const r=e.get(d);if(r.scrollOffset+r.size>=t+i)break;d++}return a=Math.min(s,d),c=Math.min(r-1,a+n),o<0&&(o=0,a=-1,l=0,c=-1),{startIndexVisible:o,stopIndexVisible:a,startIndexOverscan:l,stopIndexOverscan:c}}function b({itemCount:e,itemProps:t,itemSize:i}){return(0,d.useMemo)(()=>function({itemCount:e,itemProps:t,itemSize:i}){const r=new Map;return{get(n){for(v(n<e,`Invalid index ${n}`);r.size-1<n;){const e=r.size;let s;switch(typeof i){case"function":s=i(e,t);break;case"number":s=i}if(0===e)r.set(e,{size:s,scrollOffset:0});else{const t=r.get(e-1);v(void 0!==t,`Unexpected bounds cache miss for index ${n}`),r.set(e,{scrollOffset:t.scrollOffset+t.size,size:s})}}const s=r.get(n);return v(void 0!==s,`Unexpected bounds cache miss for index ${n}`),s},set(e,t){r.set(e,t)},get size(){return r.size}}}({itemCount:e,itemProps:t,itemSize:i}),[e,t,i])}function y({containerElement:e,containerStyle:t,defaultContainerSize:i=0,direction:r,isRtl:n=!1,itemCount:s,itemProps:o,itemSize:a,onResize:l,overscanCount:c}){const[f,y]=(0,d.useState)({startIndexVisible:0,startIndexOverscan:0,stopIndexVisible:-1,stopIndexOverscan:-1}),{startIndexVisible:k,startIndexOverscan:j,stopIndexVisible:z,stopIndexOverscan:C}={startIndexVisible:Math.min(s-1,f.startIndexVisible),startIndexOverscan:Math.min(s-1,f.startIndexOverscan),stopIndexVisible:Math.min(s-1,f.stopIndexVisible),stopIndexOverscan:Math.min(s-1,f.stopIndexOverscan)},{height:S=i,width:N=i}=function({box:e,defaultHeight:t,defaultWidth:i,disabled:r,element:n,mode:s,style:o}){const{styleHeight:a,styleWidth:l}=(0,d.useMemo)(()=>({styleHeight:h(o?.height),styleWidth:h(o?.width)}),[o?.height,o?.width]),[c,m]=(0,d.useState)({height:t,width:i}),f=r||"only-height"===s&&void 0!==a||"only-width"===s&&void 0!==l||void 0!==a&&void 0!==l;return u(()=>{if(null===n||f)return;const t=new ResizeObserver(e=>{for(const t of e){const{contentRect:e,target:i}=t;n===i&&m(t=>t.height===e.height&&t.width===e.width?t:{height:e.height,width:e.width})}});return t.observe(n,{box:e}),()=>{t?.unobserve(n)}},[e,f,n,a,l]),(0,d.useMemo)(()=>({height:a??c.height,width:l??c.width}),[c,a,l])}({defaultHeight:"vertical"===r?i:void 0,defaultWidth:"horizontal"===r?i:void 0,element:e,mode:"vertical"===r?"only-height":"only-width",style:t}),_=(0,d.useRef)({height:0,width:0}),I="vertical"===r?S:N,O=function({containerSize:e,itemSize:t}){let i;"string"==typeof t?(v(t.endsWith("%"),`Invalid item size: "${t}"; string values must be percentages (e.g. "100%")`),v(void 0!==e,"Container size must be defined if a percentage item size is specified"),i=e*parseInt(t)/100):i=t;return i}({containerSize:I,itemSize:a});(0,d.useLayoutEffect)(()=>{if("function"==typeof l){const e=_.current;(e.height!==S||e.width!==N)&&(l({height:S,width:N},{...e}),e.height=S,e.width=N)}},[S,l,N]);const M=b({itemCount:s,itemProps:o,itemSize:O}),A=(0,d.useCallback)(e=>M.get(e),[M]),R=(0,d.useCallback)(()=>p({cachedBounds:M,itemCount:s,itemSize:O}),[M,s,O]),L=(0,d.useCallback)(t=>{const i=x({containerElement:e,direction:r,isRtl:n,scrollOffset:t});return w({cachedBounds:M,containerScrollOffset:i,containerSize:I,itemCount:s,overscanCount:c})},[M,e,I,r,n,s,c]);u(()=>{y(L(("vertical"===r?e?.scrollTop:e?.scrollLeft)??0))},[e,r,L]),u(()=>{if(!e)return;const t=()=>{y(t=>{const{scrollLeft:i,scrollTop:o}=e,a=x({containerElement:e,direction:r,isRtl:n,scrollOffset:"vertical"===r?o:i}),l=w({cachedBounds:M,containerScrollOffset:a,containerSize:I,itemCount:s,overscanCount:c});return g(l,t)?t:l})};return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)}},[M,e,I,r,s,c]);const T=m(({align:t="auto",containerScrollOffset:i,index:o})=>{let a=function({align:e,cachedBounds:t,index:i,itemCount:r,itemSize:n,containerScrollOffset:s,containerSize:o}){const a=p({cachedBounds:t,itemCount:r,itemSize:n}),l=t.get(i),c=Math.max(0,Math.min(a-o,l.scrollOffset)),d=Math.max(0,l.scrollOffset-o+l.size);switch("smart"===e&&(e=s>=d&&s<=c?"auto":"center"),e){case"start":return c;case"end":return d;case"center":return l.scrollOffset<=o/2?0:l.scrollOffset+l.size/2>=a-o/2?a-o:l.scrollOffset+l.size/2-o/2;default:return s>=d&&s<=c?s:s<d?d:c}}({align:t,cachedBounds:M,containerScrollOffset:i,containerSize:I,index:o,itemCount:s,itemSize:O});if(e){if(a=x({containerElement:e,direction:r,isRtl:n,scrollOffset:a}),"function"!=typeof e.scrollTo){const e=L(a);g(f,e)||y(e)}return a}});return{getCellBounds:A,getEstimatedSize:R,scrollToIndex:T,startIndexOverscan:j,startIndexVisible:k,stopIndexOverscan:C,stopIndexVisible:z}}function k(e){return(0,d.useMemo)(()=>e,Object.values(e))}function j(e,t){const{ariaAttributes:i,style:r,...n}=e,{ariaAttributes:s,style:o,...a}=t;return g(i,s)&&g(r,o)&&g(n,a)}const z="data-react-window-index";function C({children:e,className:t,defaultHeight:i=0,listRef:r,onResize:n,onRowsRendered:s,overscanCount:o=3,rowComponent:a,rowCount:l,rowHeight:h,rowProps:m,tagName:f="div",style:x,...v}){const g=k(m),p=(0,d.useMemo)(()=>(0,d.memo)(a,j),[a]),[w,b]=(0,d.useState)(null),C=function(e){return null!=e&&"object"==typeof e&&"getAverageRowHeight"in e&&"function"==typeof e.getAverageRowHeight}(h),S=(0,d.useMemo)(()=>C?e=>h.getRowHeight(e)??h.getAverageRowHeight():h,[C,h]),{getCellBounds:N,getEstimatedSize:_,scrollToIndex:I,startIndexOverscan:O,startIndexVisible:M,stopIndexOverscan:A,stopIndexVisible:R}=y({containerElement:w,containerStyle:x,defaultContainerSize:i,direction:"vertical",itemCount:l,itemProps:g,itemSize:S,onResize:n,overscanCount:o});(0,d.useImperativeHandle)(r,()=>({get element(){return w},scrollToRow({align:e="auto",behavior:t="auto",index:i}){const r=I({align:e,containerScrollOffset:w?.scrollTop??0,index:i});"function"==typeof w?.scrollTo&&w.scrollTo({behavior:t,top:r})}}),[w,I]),u(()=>{if(!w)return;const e=Array.from(w.children).filter((e,t)=>{if(e.hasAttribute("aria-hidden"))return!1;const i=`${O+t}`;return e.setAttribute(z,i),!0});return C?h.observeRowElements(e):void 0},[w,C,h,O,A]),(0,d.useEffect)(()=>{O>=0&&A>=0&&s&&s({startIndex:M,stopIndex:R},{startIndex:O,stopIndex:A})},[s,O,M,A,R]);const L=(0,d.useMemo)(()=>{const e=[];if(l>0)for(let t=O;t<=A;t++){const i=N(t);e.push((0,d.createElement)(p,{...g,ariaAttributes:{"aria-posinset":t+1,"aria-setsize":l,role:"listitem"},key:t,index:t,style:{position:"absolute",left:0,transform:`translateY(${i.scrollOffset}px)`,height:C?void 0:i.size,width:"100%"}}))}return e},[p,N,C,l,g,O,A]),T=(0,c.jsx)("div",{"aria-hidden":!0,style:{height:_(),width:"100%",zIndex:-1}});return(0,d.createElement)(f,{role:"list",...v,className:t,ref:b,style:{position:"relative",maxHeight:"100%",flexGrow:1,overflowY:"auto",...x}},L,e,T)}var S=i(979);const N=({track:e,index:t,isActive:i,onRemove:a,onSelect:d,onUpdateArtwork:u,onUpdateTrack:h})=>{const[m,f]=(0,r.useState)(!1),[x,v]=(0,r.useState)(e.title||""),[g,p]=(0,r.useState)(e.artist||""),{attributes:w,listeners:b,setNodeRef:y,transform:k,transition:j,isDragging:z}=(0,l.gl)({id:e.id}),C={transform:S.Ks.Transform.toString(k),transition:j,opacity:z?.5:1};return(0,c.jsx)("div",{ref:y,style:C,className:"fluxwave-track-item rounded-lg border transition-all "+(i?"bg-indigo-50 border-indigo-300 shadow-sm":z?"bg-gray-100 border-gray-300":"bg-white border-gray-200 hover:border-gray-300 hover:shadow-sm"),children:(0,c.jsxs)("div",{className:"flex items-center gap-3 p-3",children:[(0,c.jsx)("div",{...w,...b,className:"flex-shrink-0 cursor-grab active:cursor-grabbing p-1 text-gray-400 hover:text-gray-600",children:(0,c.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("path",{d:"M7 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 2zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 14zm6-8a2 2 0 1 0-.001-4.001A2 2 0 0 0 13 6zm0 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 14z"})})}),(0,c.jsx)("div",{className:"flex-shrink-0 w-8 text-center text-sm font-medium text-gray-600",children:t+1}),(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(o.MediaUpload,{onSelect:t=>{u&&u(e.id,t.url)},allowedTypes:["image"],value:e.artworkId,render:({open:t})=>(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{className:"relative group cursor-pointer mb-1",onClick:e=>{e.stopPropagation(),t()},title:e.artwork?(0,n.__)("Click to change artwork","fluxwave"):(0,n.__)("Click to add artwork","fluxwave"),children:e.artwork?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("img",{src:e.artwork,alt:e.title,className:"w-16 h-16 rounded object-cover border-2 border-gray-200"}),(0,c.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 rounded flex items-center justify-center transition-all",children:(0,c.jsx)("svg",{className:"w-6 h-6 text-white opacity-0 group-hover:opacity-100 transition-opacity",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]}):(0,c.jsxs)("div",{className:"w-16 h-16 rounded bg-gradient-to-br from-gray-100 to-gray-200 border-2 border-dashed border-gray-400 flex flex-col items-center justify-center text-gray-500 hover:border-indigo-400 hover:text-indigo-500 hover:bg-gradient-to-br hover:from-indigo-50 hover:to-blue-50 transition-all",children:[(0,c.jsx)("svg",{className:"w-7 h-7 mb-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,c.jsx)("span",{className:"text-[9px] font-medium",children:"Image"})]})}),(0,c.jsx)("p",{className:"text-[10px] text-gray-500",children:e.artwork?(0,n.__)("Change","fluxwave"):(0,n.__)("Add Art","fluxwave")})]})})}),m?(0,c.jsxs)("div",{className:"flex-grow min-w-0 space-y-2",children:[(0,c.jsx)(s.TextControl,{label:(0,n.__)("Track Title","fluxwave"),value:x,onChange:v,className:"mb-0"}),(0,c.jsx)(s.TextControl,{label:(0,n.__)("Artist","fluxwave"),value:g,onChange:p,className:"mb-0"}),(0,c.jsxs)("div",{className:"flex gap-2 pt-1",children:[(0,c.jsx)(s.Button,{variant:"primary",size:"small",onClick:()=>{h&&h(e.id,{title:x,artist:g}),f(!1)},children:(0,n.__)("Save","fluxwave")}),(0,c.jsx)(s.Button,{variant:"secondary",size:"small",onClick:()=>{v(e.title||""),p(e.artist||""),f(!1)},children:(0,n.__)("Cancel","fluxwave")})]})]}):(0,c.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,c.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.title||(0,n.__)("Untitled","fluxwave")}),e.artist&&(0,c.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.artist})]}),(0,c.jsx)("div",{className:"flex-shrink-0 text-sm text-gray-500",children:(e=>{if(!e||isNaN(e)||!isFinite(e))return"--:--";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`})("number"==typeof e.duration?e.duration:parseFloat(e.duration)||0)}),!m&&(0,c.jsx)(s.Button,{isSmall:!0,variant:"secondary",onClick:e=>{e.stopPropagation(),f(!0)},className:"flex-shrink-0",title:(0,n.__)("Edit track info","fluxwave"),children:(0,c.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),!m&&(0,c.jsx)(s.Button,{isSmall:!0,isDestructive:!0,variant:"secondary",onClick:t=>{t.stopPropagation(),a(e.id)},className:"flex-shrink-0",title:(0,n.__)("Remove track","fluxwave"),children:(0,c.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})},_=(0,r.memo)(({tracks:e,onReorder:t,onRemove:i,activeTrackId:s,onSelectTrack:o,onUpdateArtwork:d,onUpdateTrack:u})=>{const h=e.length>=50,m=(0,r.useMemo)(()=>[(0,a.MS)(a.AN,{activationConstraint:{distance:8}}),(0,a.MS)(a.uN,{coordinateGetter:l.JR})],[]),f=(0,a.FR)(...m),x=(0,r.useMemo)(()=>e.map(e=>e.id),[e]);if(0===e.length)return(0,c.jsxs)("div",{className:"fluxwave-track-list-empty py-12 text-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[(0,c.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),(0,c.jsx)("p",{className:"text-gray-600 font-medium",children:(0,n.__)("No tracks in playlist","fluxwave")}),(0,c.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:(0,n.__)('Use the "Add Audio Files" button to add tracks',"fluxwave")})]});return(0,c.jsx)(a.Mp,{sensors:f,collisionDetection:a.fp,onDragEnd:i=>{const{active:r,over:n}=i;if(r.id!==n?.id){const i=e.findIndex(e=>e.id===r.id),s=e.findIndex(e=>e.id===n.id);if(-1!==i&&-1!==s){const r=(0,l.be)(e,i,s);t(r)}}},children:(0,c.jsx)(l.gB,{items:x,strategy:l._G,children:h?(0,c.jsxs)("div",{className:"fluxwave-track-list",children:[(0,c.jsx)("div",{className:"mb-2 text-xs text-gray-500 text-center",children:(0,n.__)("Large playlist - using optimized scrolling","fluxwave")}),(0,c.jsx)(C,{height:600,itemCount:e.length,itemSize:80,width:"100%",children:({index:t,style:r})=>{const n=e[t];return(0,c.jsx)("div",{style:r,children:(0,c.jsx)(N,{track:n,index:t,isActive:n.id===s,onRemove:i,onSelect:o,onUpdateArtwork:d,onUpdateTrack:u},n.id)})}})]}):(0,c.jsx)("div",{className:"fluxwave-track-list space-y-2",children:e.map((e,t)=>(0,c.jsx)(N,{track:e,index:t,isActive:e.id===s,onRemove:i,onSelect:o,onUpdateArtwork:d,onUpdateTrack:u},e.id))})})})});_.displayName="TrackList";const I=_,O=({tracks:e,onChange:t})=>{const[i,a]=(0,r.useState)(null);return(0,c.jsxs)("div",{className:"fluxwave-playlist-editor",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:(0,n.__)("Playlist","fluxwave")}),(0,c.jsx)("p",{className:"text-sm text-gray-600",children:0===e.length?(0,n.__)("No tracks added yet","fluxwave"):1===e.length?(0,n.__)("1 track","fluxwave"):(0,n.__)("%d tracks","fluxwave").replace("%d",e.length)})]}),(0,c.jsxs)("div",{className:"flex gap-2",children:[e.length>0&&(0,c.jsx)(s.Button,{variant:"secondary",isDestructive:!0,onClick:()=>{window.confirm((0,n.__)("Are you sure you want to remove all tracks?","fluxwave"))&&(t([]),a(null))},className:"text-sm",children:(0,n.__)("Clear All","fluxwave")}),(0,c.jsx)(o.MediaUploadCheck,{children:(0,c.jsx)(o.MediaUpload,{onSelect:i=>{const r=i.map(e=>{let t=0;if(e.meta?.length_formatted){const i=String(e.meta.length_formatted).split(":");if(2===i.length){t=60*(parseInt(i[0],10)||0)+(parseInt(i[1],10)||0)}}else e.meta?.length?t=parseFloat(e.meta.length):e.fileLength&&(t=parseFloat(e.fileLength));return{id:e.id,url:e.url,title:e.title||e.filename,artist:e.meta?.artist||"",album:e.meta?.album||"",artwork:e.sizes?.thumbnail?.url||e.icon,artworkId:null,duration:!isNaN(t)&&isFinite(t)&&t>0?t:0}});t([...e,...r])},allowedTypes:["audio"],multiple:!0,value:e.map(e=>e.id),render:({open:t})=>(0,c.jsx)(s.Button,{variant:"primary",onClick:t,children:0===e.length?(0,n.__)("Add Audio Files","fluxwave"):(0,n.__)("Add More","fluxwave")})})})]})]}),(0,c.jsx)(I,{tracks:e,onReorder:e=>{t(e)},onRemove:r=>{const n=e.filter(e=>e.id!==r);t(n),i===r&&a(null)},activeTrackId:i,onSelectTrack:a,onUpdateArtwork:(i,r)=>{const n=e.map(e=>e.id===i?{...e,artwork:r}:e);t(n)},onUpdateTrack:(i,r)=>{const n=e.map(e=>e.id===i?{...e,...r}:e);t(n)}}),e.length>1&&(0,c.jsx)("p",{className:"text-xs text-gray-500 mt-3 text-center",children:(0,n.__)("\u{1f4a1} Drag tracks to reorder your playlist","fluxwave")})]})}}}]);